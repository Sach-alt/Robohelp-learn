<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="UTF-8"/><title>‎Destinations, rates and tariffs</title><meta name="generator" content="Adobe RoboHelp 2019"/><link rel="stylesheet" href="../assets/css/default.css"/><link rel="stylesheet" href="../assets/css/PortaBilling_Admin_Guide_MR82.css"/></head><body><div><h2><br/>‎<a id="_Toc133593923"></a><a id="_Toc31205392"></a><span>Destinations, rates and tariffs</span></h2><p>Destinations, rates and tariffs are the essential parameters that define how a certain event must be billed. It is very important to find a correct set of billing parameters and rules (rates) for each event, and this is done by matching a service identifier with the rates available in the rate plan (tariff). The service identifier specifies exactly how the service is used. For example, the service identifier for voice calls would be the destination number (Called-Station-Id, or CLD, or DNIS). For SMS messages, it would be a combination of a mobile country code (MCC) and a mobile network code (MNC), while for services such as a pay-per-view movie it could be the movie category (“New Release,” “International” or “Classic”). Since rating telephony numbers is the most complex case, that will be the primary focus of this chapter.</p><h3>Destinations</h3><p>Destinations are a list of all possible phone number prefixes to be used in your system. You generally need a new phone prefix when you have a new service area for calls which are to be treated differently than others. </p><p>For example, if you start providing calls to the Czech Republic, you should add destination 420 and specify it as the Czech Republic. Later, if you plan to charge calls to Prague differently than calls to the rest of the Czech Republic, you might need to add another destination with the phone number prefix 4202. All such destinations must be entered into the system before you can use these prefixes. This prevents errors and helps improve data quality. It is recommended that all of your phone number prefixes be defined in the E.164 format (i.e. &lt;country code&gt;&lt;area code&gt;&lt;user’s local number&gt; without the ‘+’ prefix).</p><p> </p><p>For SMS delivery, however, you operate with mobile country codes (MCC) and mobile network codes (MNC) for phone numbers. Therefore, to charge users for an SMS to the Czech Republic via Vodafone, you would define the phone number prefix 42077 as the 230-03 code pair and add destination E.212-230-03 for the Czech Republic – Vodafone network in PortaBilling®. The format that defines phone numbers as a combination of MCC / MNC codes is called E.212 format.</p><p> </p><p>It is virtually impossible to have an “ultimate” destination list that would contain all the prefixes for the whole world. First of all, it would be quite difficult to gather and maintain such information and second, and more importantly, having “all possible” prefixes would not offer any real benefits, and would only make rate maintenance more difficult. </p><p> </p><p>For instance, if vendor A provides you with a rate of 0.10/min for calls to 420 (Czech Republic) and a 0.18 rate for calls to 420602 and 420603, you must create three prefixes: 420, 420602 and 420603. If you also create the prefix 4205 (Czech Republic, Brno) it will only take up space in the database since it will never actually be used.</p><p> </p><p>Therefore, we recommend that you follow a “required minimum” approach: only create those destinations for which you need specific rates for your carriers or customers.</p><p> </p><p>For service types other than those based on phone numbers, you may create symbolic destinations such as WIFI, NETACCESS or MOVIE-BLOCKBUSTER.</p><h3>Destination groups</h3><p>Sometimes you will have several prefixes for the same target destination, e.g. 420602, 420603 and 420737 for mobile numbers in the Czech Republic. All of these prefixes can be defined as the single destination group “CZ Mobile”, so when you enter a new rate for this destination group it will, in effect, create rates for each individual prefix.</p><h3>Destination group sets</h3><p>It happens quite often that different partners will assign a different meaning to the same destination groups. For instance, your partner A says that “CZ Mobile” is 420602, 420603 and 420737, but your partner B also considers prefix 420777 to be part of “CZ Mobile”. So you will need to have two versions of “CZ Mobile” – one for partner A and one for partner B. In this situation, you will create two separate destination group sets (“A” and “B”), as well as different destination groups inside those sets.</p><p> </p><p></p><p> </p><p>You can imagine each destination group set as a binder, with every page in that binder describing a certain destination group.</p><h4>Complete destination group sets </h4><p>In a complete destination group set any prefix that is used in the system belongs uniquely to only one destination group. This allows service providers to clearly recognize traffic sent through their networks by their target destinations. </p><p> </p><p>When an administrator creates a complete destination group set, it comes with a Default Group that includes all the prefixes available in the system. Upon adding new destination groups in the complete destination group set, the administrator moves the prefixes from the Default Group to these new groups.</p><p> </p><p>A destination group in a complete destination group set (except Default Group) can have sub-groups. This allows the administrator to further distinguish the traffic flow. For example, to monitor calls sent to premium-rate numbers in the UK, the administrator defines UK Proper and UK Mobile sub-groups for the UK destination group. In this case, the UK destination group contains all of the prefixes added to its sub-groups.</p><p> </p><p><img src="../assets/images/PortaBilling_Admin_Guide_MR82_files/image89.png" width="461.5" height="220.2" alt="Destination group set"/></p><p> </p><p>At this time, complete destination group sets can only be used for configuring the fraud traffic profiles that monitor calling activities for the purpose of early toll fraud detection. However, in the future, complete destination group sets will be used for configuring volume discount plans, bundle promotions and tariffs.</p><h3>Rates</h3><p>A rate is a combination of billing parameters for a specific destination. For example, you can specify that calls to 420 are charged $0.09/min during peak time and $0.07/min during off-peak time, while calls to 420609 should not be allowed at all.</p><p> </p><p>To easily manage the process of routine rate changes, each rate in PortaBilling® is assigned an exact time when it comes into effect (the Effective From attribute). This allows making an automated rate change in the future, so that a new rate can be entered today, but used only after midnight on January 1st. When an existing rate is edited, this does not replace the actual rate, but simply creates a new rate effective from this moment, so that the PortaBilling® administrator can always browse the history of rate modifications.</p><h4>Discontinuation of rates</h4><p>Since it is important to have a clear overview of the history of rate changes, when a rate is not required anymore it cannot just be deleted from the system. For instance, you used to provide a special rate for the destination 442 London, UK, but as of March 1st there is just one rate for all of the United Kingdom. If a customer calls with a question about his bill for February, you should still be able to see why calls to London were rated in a particular way.</p><p> </p><p>Therefore, rates which are no longer used are not “deleted”, but rather marked as “discontinued”. This has the same effect on call rating as if the rate was not there anymore. However, the administrator can still see all the history on the web interface, including the date when the rate became discontinued.</p><h3><a id="_Hlk501526530"></a>Tariffs</h3><p>A tariff is a complete set of rates for a specific account, customer or vendor. Thus, it should include every possible destination allowed by their service plan (e.g. in the case of a telephony service, every destination to which you want to let them call). </p><p> </p><p>It may be that the tariff will contain some prefixes that are part of more generic ones (for example, you will have a rate for the 420 prefix and for the 4202 prefix). In this case, the longest prefix match takes priority.</p><p> </p><p>What happens if a destination is not included in the tariff, and the customer tries to call there? There are two possibilities:</p><ul data-start="124" xmlns=""><li>If outgoing calls are authorized via PortaBilling® (for example, by a Switching Server or by the prepaid card’s IVR) the customer will not be authorized to call this destination.</li><li>If the gateway or switch which processes the call does not perform authorization in PortaBilling® before allowing the call to pass through, the customer will actually be able to make the call, but PortaBilling® will not be able to bill it properly, since the required information is missing. An email alert will be sent and a special CDR will be written into the database, so you will still have an overview of this call. It is highly recommended that you always use authorization of calls via PortaBilling®.<h4>Wildcard destination</h4><p>There is one special destination: | (pipe). When a rate for this destination is present in the tariff, it will match any dialed phone number. But this will only happen, of course, if there is no other, better match by the actual phone prefix. Such a rate should probably not be used in the customer’s tariff, since it effectively authorizes him to call any phone number in the world. It is very useful, however, in tariffs for internal purposes. For instance, we can use it in the tariff used to produce CDRs for SIP-to-SIP on-net calls, since there the cost is zero regardless of which number is actually dialed. Otherwise, that tariff would have to include all phone prefixes for all possible phone numbers assigned to IP phones. </p><p> </p><p>Also, for some services or billing features you may need to create other destinations. For example, in order to charge calls between extensions in the same IP Centrex environment according to a pre-defined rate, you will need the destination VOICEONNETRX. Consult the reference manual for a particular feature to find out which additional destinations it may require.</p><h4>Relationship between destinations, rates and tariffs</h4><p>Let’s move from VoIP to a simpler scenario. Imagine you are the owner of an office supply store. You have to manage your inventory and price lists for customers and resellers. </p></li><li>First of all, you must create a catalog of all the items you intend to sell. This is your internal document containing entries such as “20001 – ball-point pen, blue; 20002 – ball-point pen; black; 50345 – stapler;” and so on. Note that this is just a description of the items, without prices, since the price will depend on the specific vendor/customer.</li><li>You will receive price lists from your suppliers and convert them into data files for every vendor, such as “Office Depot: 20001 – $0.35; 20002 – $0.35; etc.” Note two things: there is no need to include an item description in every file – you can always extract this from the catalog of items you have created above. Also, each data file will contain only some of the items, i.e. those which are provided by this particular supplier.</li><li>The next step is to create similar price lists, but with the prices you will apply to your customers. Of course, you might have several such price lists: e.g. one for retail customers, another for business customers, yet another for resellers, and so on. Every data file will contain all of the items you offer to this category of customers, including prices.<p> </p><p>Now let’s come back to the VoIP business:</p></li><li>The catalog of items corresponds to destinations in PortaBilling®. Every destination is similar to an item description in the catalog, i.e. it provides general information (e.g. 420 – Czech Republic proper, 420602 – Czech Republic mobile, and so on).</li><li>The price list (for vendor or customer) is equal to a tariff in PortaBilling®. The price list includes all items the customer may purchase and all destinations the customer can make calls to. All tariffs are identical in structure, but some of them will be used to calculate your costs (vendor tariffs), while others will be used to charge your customers.</li><li>A single line item in the price list is equivalent to a rate in PortaBilling®. It gives the price per minute and other rating parameters for a specific destination.<p> </p><p>Therefore, the standard sequence for setting up your service is as follows:</p></li><li>Define the destinations you will use in your business. Basically you will need to define every unique prefix used by your vendors (an easy way to do this is by using PortaBilling® default destination set and PortaBilling® templates). </li><li>Create a tariff for every vendor using the rate list they supply.</li><li>Create a tariff for every customer / product. Once again, note that each tariff may contain a different set of destinations. For instance, the tariff for your vendor ABC may contain different rates for 420 (0.10/min), 4202 (0.09/min) and 420602 (0.18/min). But you can just list a single rate for your customer in the tariff, i.e. 420 – 0.20/min.<h4>Relationship between tariffs and destination group sets</h4><p>As mentioned before, multiple destination group sets may be defined in the system, with some destination groups (e.g. CZ-Mobile) defined for each of them. So, when you enter a new rate for CZ-Mobile in a specific tariff, which destination group definition should be used? To avoid such ambiguities, you will assign a destination group set for every tariff, which will be used to create new rates (if you do not assign a destination group set to the tariff, then you can only enter rates for individual prefixes). Thus when you attempt to create a new rate for destination group CZ-Mobile, the following sequence of events takes place:</p></li><li>PortaBilling® locates the definition of the CZ-Mobile destination group in the destination group set associated with this tariff.</li><li>For every destination included in this destination group, the new rate is inserted.<p> </p><p>In other words, the result is the same as if you had created multiple rate entries manually. Rates which are created using a destination group do not differ in any way from rates created for a single destination. One important consequence of the foregoing is that if you change the destinations included in a destination group, it will not affect the previously created rates. Thus if you had 420602 and 420603 in the CZ-Mobile destination group, and you now add 420737, this will not affect any of the tariffs. In order to have correct billing for the 420737 prefix, you must go to the corresponding tariff and add a new rate for the CZ-Mobile prefix.</p></li></ul></div></body></html>